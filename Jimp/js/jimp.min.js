/*
 * Jimp JQuery Plugin
 * http://hompimpaalaihumgambreng.blogspot.com/
 *
 * Copyright 2012, Taufik Nurrohman
 * Free to use and abuse under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 */
(function(a){a.fn.jimp=function(b){b=a.extend({width:40,height:40,resizeSpeed:200,fadeSpeed:400,delay:1000,offsetTop:20,offsetLeft:20,closeText:"&#215",linkText:"save",hideOnOut:false,hideOnChange:false},b);if(!a("#jimp").length){a(document.body).append('<div id="jimp" class="movable"></div>')}return this.each(function(){var i=a(this),g=b.width,d=b.height,c=a(window).width(),f=a(window).height(),j=a(".movable"),h=null;a(this).attr("title",a(this).attr("title")?a(this).attr("title"):"");i.data("title",a(this).attr("title")).removeAttr("title");j.css({width:g,height:d});i.on({mouseenter:function(o){if(a("img",j).attr("src")!==this.href){var l=a(this).data("preview")?a(this).data("preview"):this.href,n=o.clientY+b.offsetTop,k=o.clientX+b.offsetLeft,m=a(this).data("title");if(b.hideOnChange||b.hideOnOut){j.hide().css({width:g,height:d}).html("")}j.html("").addClass("loading movable");h=setTimeout(function(){j.show().html('<img src="'+l+'" alt="Loading..."/><span class="anchor"><a class="link" href="'+l+'" target="_blank">'+b.linkText+'</a><a class="closejimp" href="#">'+b.closeText+"</a></span>");a("img",j).css("opacity",0).load(function(q){var p=a(this).outerWidth(),r=a(this).outerHeight();if(n+r>f){n=f-r-b.offsetTop}if(k+p>c){k=c-p-b.offsetLeft}a(this).parent().stop().animate({width:a(this).width(),height:a(this).height(),top:n,left:k},b.resizeSpeed,function(){a(this).removeClass("loading").find("img").stop().animate({opacity:1},b.fadeSpeed,function(){a(window).off("mousemove");a(this).before("<h4>"+m+"</h4>")});j.find(".closejimp").on("click",function(){j.fadeOut(b.fadeSpeed/2,function(){a(this).html("").css({width:g,height:d}).addClass("movable");e()});return false})})})},b.delay)}},mouseleave:function(){if(h!==null){clearTimeout(h)}if(b.hideOnOut){j.hide().css({width:g,height:d}).html("")}}});function e(){a(window).on({mousemove:function(n){var p=a(".movable"),l=p.outerWidth(),o=p.outerHeight(),m=n.clientY+b.offsetTop,k=n.clientX+b.offsetLeft;if(m+o>f){m=f-o-b.offsetTop}if(k+l>c){k=c-l-b.offsetLeft}p.css({top:m,left:k})}})}e()})}})(jQuery);